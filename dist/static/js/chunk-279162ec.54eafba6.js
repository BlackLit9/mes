(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-279162ec"],{"50d7":function(e,t,n){},"6f8a":function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-select",{attrs:{placeholder:"请选择试验指标",clearable:""},on:{"visible-change":e.visibleChange,change:e.changeSelect},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},e._l(e.options,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)},i=[],l=(n("96cf"),n("1da1")),r=n("1f6c"),o={props:{},data:function(){return{value:"",options:[]}},watch:{},methods:{getList:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(r["P"])("get",null,{all:1});case 3:n=t.sent,e.options=n||[],t.next=9;break;case 7:t.prev=7,t.t0=t["catch"](0);case 9:case"end":return t.stop()}}),t,null,[[0,7]])})))()},visibleChange:function(e){e&&0===this.options.length&&this.getList()},changeSelect:function(e){this.$emit("changeSelect",e)}}},s=o,c=n("2877"),u=Object(c["a"])(s,a,i,!1,null,null,null);t["a"]=u.exports},"721c":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[n("el-form",{attrs:{inline:!0}},[n("el-form-item",{attrs:{label:"胶料编码:"}},[n("all-product-no-select",{on:{productBatchingChanged:e.productBatchingChanged}})],1),n("el-form-item",{attrs:{label:"试验指标:"}},[n("detection-index",{on:{changeSelect:e.detectionIndexSelect}})],1),n("el-form-item",{attrs:{label:"试验类型:"}},[n("test-type-select",{on:{changeSelect:e.typeSelectTable}})],1),n("el-form-item",{directives:[{name:"permission",rawName:"v-permission",value:["evaluating","add"],expression:"['evaluating','add']"}]},[n("el-button",{on:{click:e.addDialog}},[e._v("新增")])],1)],1),n("el-table",{attrs:{data:e.tableData,border:""}},[n("el-table-column",{attrs:{type:"index",label:"No"}}),n("el-table-column",{attrs:{prop:"material_no",label:"胶料编码"}}),n("el-table-column",{attrs:{prop:"test_indicator_name",label:"检测指标"}}),n("el-table-column",{attrs:{prop:"test_type_name",label:"试验类型"}}),n("el-table-column",{attrs:{prop:"test_method_name",label:"试验方法"}}),n("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["evaluating","change"],expression:"['evaluating','change']"}],attrs:{size:"small"},on:{click:function(n){return e.editClick(t.row)}}},[e._v("编辑")])]}}])})],1),n("page",{attrs:{total:e.total,"current-page":e.search.page},on:{currentChange:e.currentChange}}),n("el-dialog",{attrs:{title:"新增",visible:e.dialogVisible,width:"50%","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("el-form",{ref:"addForm",attrs:{model:e.addForm,rules:e.rules,"label-width":"120px"}},[n("el-form-item",{attrs:{label:"胶料编码:",prop:"material"}},[n("el-select",{attrs:{placeholder:"请选择胶料编码",filterable:""},model:{value:e.addForm.material,callback:function(t){e.$set(e.addForm,"material",t)},expression:"addForm.material"}},e._l(e.optionsRubber,(function(e){return n("el-option",{key:e.id,attrs:{label:e.material_no,value:e.id}})})),1)],1),n("el-form-item",{attrs:{label:"试验类型:",prop:"b"}},[n("test-type-select",{ref:"testTypeSelect",on:{changeSelect:e.typeSelect}})],1),n("el-form-item",{attrs:{label:"试验方法:",prop:"test_method"}},[n("test-method-select",{ref:"testMethodSelect",attrs:{"is-type-filter":!0,"is-required":!0,"new-test-type-id":e.addForm.b},on:{changeSelect:e.testMethodChange}})],1),n("el-form-item",{attrs:{label:"数据点:",prop:"data_point"}},[n("test-type-dot-select",{ref:"testTypeDotSelect",attrs:{"multiple-is":!0,"test-type-id":e.addForm.b},on:{changSelect:e.changSelectDot}})],1)],1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.clearForm}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary",loading:e.loadingBtn},on:{click:e.sureAdd}},[e._v("确 定")])],1)],1),n("edit-dialog",{attrs:{"edit-show":e.editShow,"obj-edit":e.objEdit},on:{handleCloseEdit:e.handleCloseEdit}})],1)},i=[],l=(n("a434"),n("ac1f"),n("841c"),n("96cf"),n("1da1")),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-select",{attrs:{placeholder:"请选择试验类型",clearable:""},on:{"visible-change":e.visibleChange,change:e.changeSelect},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},e._l(e.options,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)},o=[],s=n("1f6c"),c={data:function(){return{value:"",options:[]}},methods:{getList:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(s["R"])("get",null,{params:{all:1}});case 3:n=t.sent,a=n.results,e.options=a||[],t.next=10;break;case 8:t.prev=8,t.t0=t["catch"](0);case 10:case"end":return t.stop()}}),t,null,[[0,8]])})))()},visibleChange:function(e){e&&0===this.options.length&&this.getList()},changeSelect:function(e){this.$emit("changeSelect",e)}}},u=c,d=n("2877"),h=Object(d["a"])(u,r,o,!1,null,null,null),p=h.exports,m=n("dbca"),f=n("6f8a"),b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-select",{attrs:{placeholder:"请选择数据点",multiple:e.multipleIs,loading:e.loading},on:{"visible-change":e.visibleChange,change:e.changSelect},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},e._l(e.options,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)},g=[],v=(n("a9e3"),{props:{multipleIs:{type:Boolean,default:!1},testTypeId:{type:Number,default:null},createdIs:{type:Boolean,default:!1}},data:function(){return{value:this.multipleIs?[]:"",loading:!1,options:[]}},watch:{testTypeId:function(e){this.options=[],e&&this.getList()}},created:function(){this.createdIs&&this.getList()},methods:{getList:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e.loading=!0,t.next=4,Object(s["i"])("get",null,{params:{test_type_id:e.testTypeId,all:1}});case 4:n=t.sent,e.options=n.results||[],e.loading=!1,t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](0),e.loading=!1;case 12:case"end":return t.stop()}}),t,null,[[0,9]])})))()},visibleChange:function(e){},changSelect:function(e){this.$emit("changSelect",e)}}}),_=v,w=Object(d["a"])(_,b,g,!1,null,null,null),x=w.exports,k=n("3e51"),S=n("5dce"),y=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-dialog",{attrs:{title:"编辑",visible:e.dialogVisible,width:"80%","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[n("el-form",{attrs:{inline:!0}},[n("el-form-item",{attrs:{label:"胶料编码:"}},[e._v(" "+e._s(e.objEdit.material_no)+" ")]),n("el-form-item",{attrs:{label:"检测指标:"}},[e._v(" "+e._s(e.objEdit.test_indicator_name)+" ")]),n("el-form-item",{attrs:{label:"试验类型:"}},[e._v(" "+e._s(e.objEdit.test_type_name)+" ")]),n("el-form-item",{attrs:{label:"试验方法:"}},[e._v(" "+e._s(e.objEdit.test_method_name)+" ")])],1),n("div",{staticStyle:{"margin-bottom":"5px","line-height":"19px"}},[e._v(" 提示：请每个数据点最少一个合格检测结果、等级不能重复、 "),n("br"),e._v(" 每一排上下限请给个连续区间范围(比如：第一排1-10;第二排11-100;第三排101-200,以此类推) "),n("br"),e._v(" 请单行保存 ")]),n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""}},[n("el-table-column",{attrs:{label:"数据点名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-select",{attrs:{placeholder:"请选择"},on:{change:function(n){return e.changeMonitor(t.$index)}},model:{value:t.row.data_point,callback:function(n){e.$set(t.row,"data_point",n)},expression:"scope.row.data_point"}},e._l(e.objEdit.data_points,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)]}}])}),n("el-table-column",{attrs:{label:"上限"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",{staticClass:"aaaaa"},[n("el-input-number",{attrs:{"controls-position":"right",min:t.row.lower_limit?e.keepTwo(t.row.lower_limit+.01):-1/0},on:{change:function(n){return e.changeMonitor(t.$index)}},model:{value:t.row.upper_limit,callback:function(n){e.$set(t.row,"upper_limit",n)},expression:"scope.row.upper_limit"}})],1)]}}])}),n("el-table-column",{attrs:{label:"下限"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",{staticClass:"aaaaa"},[n("el-input-number",{attrs:{"controls-position":"right",max:t.row.upper_limit?e.keepTwo(t.row.upper_limit-.01):1/0},on:{change:function(n){return e.changeMonitor(t.$index)}},model:{value:t.row.lower_limit,callback:function(n){e.$set(t.row,"lower_limit",n)},expression:"scope.row.lower_limit"}})],1)]}}])}),n("el-table-column",{attrs:{label:"等级"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("grade-manage-select",{attrs:{"created-is":!0,"default-val":t.row.level},on:{changSelect:function(n){return e.changSelectLevel(n,t.row,t.$index)}}}),e._e()]}}])}),n("el-table-column",{attrs:{label:"检测结果"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.result)+" ")]}}])}),n("el-table-column",{attrs:{label:"更新人"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.last_updated_username||"--")+" ")]}}])}),n("el-table-column",{attrs:{label:"更新时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.last_updated_date||"--")+" ")]}}])}),n("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button-group",[n("el-button",{attrs:{size:"small",disabled:e.disabledSubmit},on:{click:function(n){return e.submitClick(t.row)}}},[e._v("保存")])],1)]}}])})],1),n("div",{staticStyle:{width:"100%","text-align":"center","margin-top":"15px"}},[n("el-button",{attrs:{size:"small"},on:{click:e.addCell}},[e._v("插入一行")])],1)],1)])],1)},j=[],$=(n("4de4"),n("4160"),n("159b"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-select",{attrs:{placeholder:"请选择等级",loading:e.loading},on:{"visible-change":e.visibleChange,change:e.changSelect},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},e._l(e.options,(function(e){return n("el-option",{key:e.id,attrs:{label:e.level,value:e.id}})})),1)],1)}),R=[],C={props:{createdIs:{type:Boolean,default:!1},defaultVal:{type:Number,default:null}},data:function(){return{value:"",loading:!1,options:[]}},watch:{testTypeId:function(e){this.options=[],e&&this.getList()},defaultVal:function(e){this.value=e}},created:function(){this.createdIs&&(this.getList(),this.value=this.defaultVal)},methods:{getList:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e.loading=!0,t.next=4,Object(s["u"])("get",null,{params:{all:1}});case 4:n=t.sent,e.options=n.results||[],e.loading=!1,t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](0),e.loading=!1;case 12:case"end":return t.stop()}}),t,null,[[0,9]])})))()},visibleChange:function(e){e&&0===this.options.length&&!this.createdIs&&this.getList()},changSelect:function(e){var t=[];t=this.options.filter((function(t){return t.id===e})),this.$emit("changSelect",t[0])}}},O=C,E=Object(d["a"])(O,$,R,!1,null,null,null),F=E.exports,I=n("ed08"),D={components:{gradeManageSelect:F},props:{editShow:{type:Boolean,default:!1},objEdit:{type:Object,default:function(){return{}}}},data:function(){return{changeRow:{},dialogVisible:!1,loading:!0,disabledSubmit:!1,tableData:[],dataPointList:[]}},watch:{editShow:function(e){this.dialogVisible=e,e&&this.getInfo()}},methods:{changeMonitor:function(e){this.changeRow.bool=!0,this.changeRow.index=e},handleClose:function(e){this.tableData=[],this.$emit("handleCloseEdit"),e()},getInfo:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(s["v"])("get",null,{params:{material_test_method_id:e.objEdit.id}});case 3:n=t.sent,e.tableData=n,e.loading=!1,t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0),e.loading=!1;case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))()},submitClick:function(e){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function n(){var a,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,e.material_test_method=t.objEdit.id,t.titleInfo(e.level,"请输入等级"),t.titleInfo(e.result,"请输入结果"),t.titleInfo(e.upper_limit,"请输入上限"),t.titleInfo(e.lower_limit,"请输入下限"),t.titleInfo(e.data_point,"请输入数据点"),t.setRange(e),t.changeRow.bool=!1,t.disabledSubmit=!0,a=e.id?"put":"post",i=e.id||null,n.next=14,Object(s["v"])(a,i,{data:e});case 14:t.disabledSubmit=!1,t.$message.success("保存成功"),t.getInfo(),n.next=22;break;case 19:n.prev=19,n.t0=n["catch"](0),t.disabledSubmit=!1;case 22:case"end":return n.stop()}}),n,null,[[0,19]])})))()},setRange:function(e){var t=Object(I["b"])(this.tableData);t=t.filter((function(t){return t.data_point===e.data_point})),t.sort(L);var n=null;if(t.forEach((function(t,a){t.id===e.id&&(n=a)})),n-1>-1){var a=t[n-1];if(a.upper_limit>=e.lower_limit)throw this.$message.info("当前行上下限范围重叠!"),new Error("error")}if(n+2<=t.length){var i=t[n+1];if(i.lower_limit<=e.upper_limit)throw this.$message.info("当前行上下限范围重叠!"),new Error("error")}},titleInfo:function(e,t){if(!e&&0!==e)throw this.$message.info(t),new Error(t)},clickDelete:function(e,t){var n=this;return Object(l["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:n.$confirm("是否删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(l["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!t.id){a.next=3;break}return a.next=3,Object(s["v"])("delete",t.id);case 3:n.$message.success("删除成功"),n.tableData.splice(e,1);case 5:case"end":return a.stop()}}),a)})))).catch((function(){}));case 1:case"end":return a.stop()}}),a)})))()},addCell:function(){this.tableData.push({}),this.changeRow.bool&&this.$message({message:this.changeRow.index+1+"行数据未保存，保存会刷新页面",type:"info",offset:150})},keepTwo:function(e){return Math.floor(100*e)/100},changSelectLevel:function(e,t,n){this.$set(t,"result",e.deal_result),this.$set(t,"level",e.id),this.changeMonitor(n)}}};function L(e,t){return e.lower_limit-t.lower_limit}var T=D,B=(n("848b"),Object(d["a"])(T,y,j,!1,null,null,null)),M=B.exports,V={components:{editDialog:M,page:k["a"],testTypeDotSelect:x,allProductNoSelect:S["a"],testTypeSelect:p,testMethodSelect:m["a"],detectionIndex:f["a"]},data:function(){var e=this,t=function(e,t,n,a,i){a?n():n(new Error(i))};return{search:{page:1},total:0,loading:!1,dialogVisible:!1,loadingBtn:!1,addForm:{material:null,b:null,test_method:null,data_point:null},optionsRubber:[],editShow:!1,rules:{material:[{required:!0,message:"请选择胶料编码",trigger:"change"}],b:[{required:!0,validator:function(n,a,i){t(n,a,i,e.addForm.b,"请选择胶料编码")}}],test_method:[{required:!0,validator:function(n,a,i){t(n,a,i,e.addForm.test_method,"请选择试验方法")}}],data_point:[{required:!0,validator:function(n,a,i){t(n,a,i,e.addForm.data_point,"请选择数据点")}}]},tableData:[],objEdit:{}}},created:function(){this.getList(),this.getRubber()},methods:{getList:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=4,Object(s["y"])("get",null,{params:e.search});case 4:n=t.sent,e.tableData=n.results,e.total=n.count,e.loading=!1,t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](1),e.loading=!1;case 13:case"end":return t.stop()}}),t,null,[[1,10]])})))()},currentChange:function(e){this.search.page=e,this.getList()},getRubber:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(s["b"])("get");case 3:n=t.sent,e.optionsRubber=n||[],t.next=9;break;case 7:t.prev=7,t.t0=t["catch"](0);case 9:case"end":return t.stop()}}),t,null,[[0,7]])})))()},typeSelectTable:function(e){this.search.test_type_id=e||"",this.search.page=1,this.getList()},detectionIndexSelect:function(e){this.search.test_indicator_id=e||"",this.search.page=1,this.getList()},typeSelect:function(e){e?this.$set(this.addForm,"b",e):this.addForm.b=null,this.$refs.testMethodSelect.testMode="",this.$refs.testTypeDotSelect.value=[]},testMethodChange:function(e){this.$set(this.addForm,"test_method",e)},changSelectDot:function(e){this.$set(this.addForm,"data_point",e)},handleClose:function(e){this.clearForm(),e()},addDialog:function(){this.dialogVisible=!0},clearForm:function(){this.dialogVisible=!1,this.$refs.addForm&&this.$refs.addForm.resetFields(),this.addForm={},this.$refs.testTypeSelect.value="",this.$refs.testMethodSelect.testMode="",this.$refs.testTypeDotSelect.value=[]},productBatchingChanged:function(e){this.search.material_no=e?e.material_no:"",this.search.page=1,this.getList()},clickDelete:function(e,t){var n=this;this.$confirm("是否删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(l["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(s["y"])("delete",t.id);case 2:n.$message.success("删除成功"),n.tableData.splice(e,1);case 4:case"end":return a.stop()}}),a)})))).catch((function(){}))},sureAdd:function(){var e=this;this.$refs.addForm.validate(function(){var t=Object(l["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!n){t.next=16;break}return t.prev=1,e.loadingBtn=!0,t.next=5,Object(s["y"])("post",null,{data:e.addForm});case 5:e.$message.success("新建成功"),e.getList(),e.loadingBtn=!1,e.clearForm(),t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](1),e.loadingBtn=!1;case 14:t.next=17;break;case 16:return t.abrupt("return",!1);case 17:case"end":return t.stop()}}),t,null,[[1,11]])})));return function(e){return t.apply(this,arguments)}}())},handleCloseEdit:function(){this.editShow=!1},editClick:function(e){this.editShow=!0,this.objEdit=e}}},N=V,q=Object(d["a"])(N,a,i,!1,null,null,null);t["default"]=q.exports},"848b":function(e,t,n){"use strict";var a=n("50d7"),i=n.n(a);i.a}}]);