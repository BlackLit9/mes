(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6f21f21a"],{"1c7e2":function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[a("el-form",{attrs:{inline:!0}},[a("el-form-item",{attrs:{label:"时间"}},[a("el-date-picker",{attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd"},on:{change:e.changeList},model:{value:e.getParams.start_time,callback:function(t){e.$set(e.getParams,"start_time",t)},expression:"getParams.start_time"}})],1),e.isDialog?e._e():a("el-form-item",{attrs:{label:"订单状态"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},on:{change:e.changeList},model:{value:e.getParams.status,callback:function(t){e.$set(e.getParams,"status",t)},expression:"getParams.status"}},e._l(e.options1,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),e.isDialog?e._e():a("el-form-item",{attrs:{label:"物料编码"}},[a("material-code-select",{on:{changeSelect:e.materialCodeFun}})],1),a("el-form-item",{attrs:{label:"发货类型"}},[a("deliverTypeSelect",{on:{changeSelect:e.deliverTypeSelectFun}})],1),a("el-form-item",{attrs:{label:"目的地"}},[a("destinationSelect",{on:{changeSelect:e.destinationSelectFun}})],1),e.isDialog?e._e():a("el-form-item",{staticStyle:{float:"right"}},[a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["delivery_plan","add"],expression:"['delivery_plan', 'add']"}],on:{click:e.showCreateDialog}},[e._v("新建")])],1)],1),a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{border:"","cell-style":e.cellStyle,data:e.tableData,"row-key":e.getRowKeys},on:{"selection-change":e.handleSelectionChange}},[e.isDialog?a("el-table-column",{attrs:{type:"selection",width:"40","reserve-selection":!0}}):e._e(),a("el-table-column",{attrs:{label:"No",type:"index",align:"center"}}),a("el-table-column",{attrs:{label:"目的地",align:"center",prop:"dispatch_location_name"}}),a("el-table-column",{attrs:{label:"发货单号",align:"center",prop:"order_no"}}),a("el-table-column",{attrs:{label:"发货类型",align:"center",prop:"dispatch_type_name"}}),a("el-table-column",{attrs:{label:"物料编码",align:"center",prop:"material_name"}}),a("el-table-column",{attrs:{label:"发货数量",align:"center",prop:"need_qty"}}),a("el-table-column",{attrs:{label:"已发数量",align:"center",prop:"actual_qty"}}),a("el-table-column",{attrs:{label:"发货重量",align:"center",prop:"need_weight"}}),a("el-table-column",{attrs:{label:"已发重量",align:"center",prop:"actual_weight"}}),a("el-table-column",{attrs:{label:"订单状态",align:"center",prop:"status_name"}}),e.isDialog?e._e():a("el-table-column",{attrs:{label:"操作",width:"134",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button-group",[2==t.row.status||4==t.row.status?a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["delivery_plan","delete"],expression:"['delivery_plan', 'delete']"}],attrs:{size:"mini"},on:{click:function(a){return e.handleClose(t.row)}}},[e._v("关闭")]):e._e(),4==t.row.status?a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["delivery_plan","change"],expression:"['delivery_plan', 'change']"}],attrs:{size:"mini",type:"blue"},on:{click:function(a){return e.showEditDialog(t.row)}}},[e._v("编辑 ")]):e._e()],1)]}}],null,!1,1594149050)}),a("el-table-column",{attrs:{label:"发起人",align:"center",prop:"dispatch_user"}}),a("el-table-column",{attrs:{label:"发起时间",align:"center",prop:"start_time"}}),e.isDialog?e._e():a("el-table-column",{attrs:{label:"完成时间",align:"center",prop:"fin_time"}})],1),a("page",{attrs:{total:e.total,"current-page":e.getParams.page},on:{currentChange:e.currentChange}}),a("el-dialog",{attrs:{title:"新建发货计划",visible:e.createDialogVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.createDialogVisible=t}}},[a("el-form",{ref:"Form",attrs:{rules:e.rules,"label-width":"100px",model:e.createForm}},[a("el-form-item",{attrs:{label:"目的地",prop:"dispatch_location"}},[a("destinationSelect",{ref:"destinationSelect",on:{changeSelect:e.destinationCreateForm}})],1),a("el-form-item",{attrs:{label:"发货类型",prop:"dispatch_type"}},[a("deliverTypeSelect",{ref:"deliverTypeSelect",on:{changeSelect:e.deliverTypeCreateForm}})],1),a("el-form-item",{attrs:{label:"物料编码",prop:"material"}},[a("material-code-select",{ref:"materialCodeSelect",on:{changeSelect:e.materialCreateForm}})],1),a("el-form-item",{attrs:{label:"发货数量",prop:"need_qty"}},[a("el-input",{staticStyle:{width:"200px"},attrs:{type:"age"},model:{value:e.createForm.need_qty,callback:function(t){e.$set(e.createForm,"need_qty",e._n(t))},expression:"createForm.need_qty"}})],1),a("el-form-item",{attrs:{label:"发货重量",prop:"need_weight"}},[a("el-input-number",{attrs:{min:0,step:.01,"step-strictly":""},model:{value:e.createForm.need_weight,callback:function(t){e.$set(e.createForm,"need_weight",t)},expression:"createForm.need_weight"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.createDialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleCreate()}}},[e._v("确 定")])],1)],1),a("el-dialog",{attrs:{title:"编辑发货计划",visible:e.editDialogVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editDialogVisible=t}}},[a("el-form",{ref:"Form",attrs:{rules:e.rules,"label-width":"100px",model:e.editForm}},[a("el-form-item",{attrs:{label:"目的地",prop:"dispatch_location"}},[a("destinationSelect",{attrs:{"default-val":e.editForm.dispatch_location,"created-is":!0},on:{changeSelect:e.destinationEditForm}})],1),a("el-form-item",{attrs:{label:"发货类型",prop:"dispatch_type"}},[a("deliverTypeSelect",{attrs:{"default-val":e.editForm.dispatch_type,"created-is":!0},on:{changeSelect:e.deliverTypeEditForm}})],1),a("el-form-item",{attrs:{label:"发货数量",prop:"need_qty"}},[a("el-input",{staticStyle:{width:"200px"},attrs:{type:"age"},model:{value:e.editForm.need_qty,callback:function(t){e.$set(e.editForm,"need_qty",e._n(t))},expression:"editForm.need_qty"}})],1),a("el-form-item",{attrs:{label:"发货重量",prop:"need_weight"}},[a("el-input-number",{model:{value:e.editForm.need_weight,callback:function(t){e.$set(e.editForm,"need_weight",t)},expression:"editForm.need_weight"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.editDialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleEdit()}}},[e._v("确 定")])],1)],1)],1)},i=[],r=(a("4de4"),a("c740"),a("4160"),a("caad"),a("159b"),a("96cf"),a("1da1")),n=a("f060"),o=a("ed08"),s=a("3e51"),c=a("cf45"),d=a("4cad"),u=a("19c7"),m=a("1313"),p={components:{page:s["a"],MaterialCodeSelect:d["a"],deliverTypeSelect:u["a"],destinationSelect:m["a"]},props:{isDialog:{type:Boolean,default:!1},materialNo:{type:String,default:null},show:{type:Boolean,default:!1},defalutVal:{type:Array,default:function(){return[]}}},data:function(){return{tableData:[],options1:c["a"].statusList,getParams:{start_time:Object(o["d"])(),page:1},createDialogVisible:!1,createForm:{},editDialogVisible:!1,editForm:{},rules:{dispatch_location:[{required:!0,message:"不能为空",trigger:"blur"}],dispatch_type:[{required:!0,message:"不能为空",trigger:"blur"}],material:[{required:!0,message:"不能为空",trigger:"blur"}],need_qty:[{required:!0,message:"不能为空",trigger:"blur"},{type:"number",message:"请输入合法整数",trigger:"blur"}],need_weight:[{required:!0,message:"不能为空",trigger:"blur"},{type:"number",message:"请输入合法数字",trigger:"blur"}]},total:1,handleSelection:[],loading:!1}},watch:{show:function(e){e&&(this.$refs.multipleTable.clearSelection(),this.getParams.page=1,this.getParams.material_no=this.materialNo||null,this.getTableData())}},updated:function(){},created:function(){this.getParams.material_no=this.materialNo||null,this.getTableData()},methods:{getTableData:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,Object(n["e"])(e.getParams).then((function(t){e.loading=!1,e.tableData=t.results,e.total=t.count,e.isDialog&&(e.tableData=e.tableData.filter((function(e){return[4,2].includes(e.status)}))),e.tableData.length>0&&e.defalutVal&&e.defalutVal.length>0&&e.tableData.forEach((function(t,a){e.defalutVal.findIndex((function(e){return e.id===t.id}))>-1&&e.$refs.multipleTable.toggleRowSelection(t)}))})).catch((function(){e.loading=!1}));case 3:case"end":return t.stop()}}),t)})))()},changeList:function(){this.getParams.page=1,this.getTableData()},materialCodeFun:function(e){this.getParams.material=e,this.getParams.page=1,this.getTableData()},deliverTypeSelectFun:function(e){this.getParams.dispatch_type=e,this.getParams.page=1,this.getTableData()},destinationSelectFun:function(e){this.getParams.dispatch_location=e,this.getParams.page=1,this.getTableData()},clearCreateForm:function(){this.$refs.destinationSelect&&(this.$refs.destinationSelect.value=""),this.$refs.deliverTypeSelect&&(this.$refs.deliverTypeSelect.value=""),this.$refs.materialCodeSelect&&(this.$refs.materialCodeSelect.value=""),this.createForm={dispatch_location:null,dispatch_type:null,material:null}},showCreateDialog:function(){var e=this;this.clearCreateForm(),this.createDialogVisible=!0,this.$nextTick((function(){e.$refs.Form.clearValidate()}))},materialCreateForm:function(e){this.createForm.material=e},deliverTypeCreateForm:function(e){this.createForm.dispatch_type=e},destinationCreateForm:function(e){this.createForm.dispatch_location=e},handleCreate:function(){var e=this;this.$refs.Form.validate((function(t){t&&Object(n["g"])(e.createForm).then((function(t){e.createDialogVisible=!1,e.$message("创建成功"),e.getParams.page=1,e.getTableData()}))}))},showEditDialog:function(e){var t=this;this.editForm=Object.assign({},e),this.editDialogVisible=!0,this.$nextTick((function(){t.$refs.Form.clearValidate()}))},destinationEditForm:function(e){this.editForm.dispatch_location=e},deliverTypeEditForm:function(e){this.editForm.dispatch_type=e},handleEdit:function(){var e=this;this.$refs.Form.validate((function(t){t&&Object(n["i"])(e.editForm,e.editForm.id).then((function(t){e.editDialogVisible=!1,e.$message("修改成功"),e.getParams.page=1,e.getTableData()}))}))},handleClose:function(e){var t=this;console.log(e.status);var a=2===e.status?"执行中":"新建";this.$confirm("此操作将关闭 "+a+" 的发货单单"+e.order_no+", 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(n["b"])(e.id).then((function(e){t.$message({type:"success",message:"操作成功!"}),t.getParams.page=1,t.getTableData()})).catch((function(){}))}))},currentChange:function(e){this.getParams.page=e,this.getTableData()},handleSelectionChange:function(e){this.handleSelection=e},clearReceiveSelect:function(){this.$refs.multipleTable.clearSelection()},getRowKeys:function(e){return e.id},cellStyle:function(e){var t=e.row,a=e.column,l=(e.rowIndex,e.columnIndex,a.property);if(t[l]&&"status_name"===l){if("关闭"===t[l])return"color: #888888";if("新建"===t[l])return"color: #000093";if("执行中"===t[l])return"color: #F5A623";if("完成"===t[l])return"color: #7ED321";if("失败"===t[l])return"color: #FF0000"}}}},g=p,h=a("2877"),f=Object(h["a"])(g,l,i,!1,null,null,null);t["default"]=f.exports},c740:function(e,t,a){"use strict";var l=a("23e7"),i=a("b727").findIndex,r=a("44d2"),n=a("ae40"),o="findIndex",s=!0,c=n(o);o in[]&&Array(1)[o]((function(){s=!1})),l({target:"Array",proto:!0,forced:s||!c},{findIndex:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),r(o)}}]);