(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0cbaf1"],{"4b5b":function(t,e,a){"use strict";a.r(e);var l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("el-form",{attrs:{inline:!0}},[a("el-form-item",{attrs:{label:"日期"}},[a("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"选择日期"},on:{change:t.dayTimeChanged},model:{value:t.getParams.day_time,callback:function(e){t.$set(t.getParams,"day_time",e)},expression:"getParams.day_time"}})],1),a("el-form-item",{attrs:{label:"机台"}},[a("equip-select",{on:{equipSelected:t.equipSelected}})],1),a("el-form-item",{attrs:{label:"班次"}},[a("class-select",{on:{classSelected:t.classSelected}})],1),a("el-form-item",{attrs:{label:"胶料"}},[a("product-no-select",{attrs:{"is-stage-productbatch-no-remove":!0,"make-use-batch":!0},on:{productBatchingChanged:t.productBatchingChanged}})],1),a("el-form-item",{attrs:{label:"综合处理意见"}}),a("el-form-item",[a("el-button",{on:{click:function(e){t.filterDialogVisible=!0}}},[t._v(" 显示过滤界面 ")])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:t.testOrders,border:"",fit:""}},[a("el-table-column",{attrs:{type:"index",label:"No"}}),a("el-table-column",{attrs:{label:"生产信息",align:"center"}},[a("el-table-column",{attrs:{label:"生产计划号",width:"95",prop:"plan_classes_uid"}}),a("el-table-column",{attrs:{label:"收皮条码",prop:"lot_no"}}),a("el-table-column",{attrs:{label:"生产班次/班组",width:"110",prop:"class_group"}}),a("el-table-column",{attrs:{label:"生产机台",prop:"production_equip_no"}}),a("el-table-column",{attrs:{label:"胶料编码",align:"center",width:"150",prop:"product_no"}}),a("el-table-column",{attrs:{label:"车次",width:"50",align:"center",prop:"actual_trains"}}),a("el-table-column",{attrs:{label:"检测状态",prop:"test_status"}})],1),t._l(t.testTypeList.filter((function(t){return t.show})),(function(e){return a("el-table-column",{key:e.test_type_name,attrs:{align:"center",label:e.test_type_name}},[t._l(e.data_indicator_detail.filter((function(t){return t.show})),(function(l){return a("el-table-column",{key:e.test_type_name+l.detail,attrs:{width:"110",label:l.detail,align:"center"},scopedSlots:t._u([{key:"default",fn:function(r){return r.row.test_indicator_list_[e.test_type_name][l.detail][0]?[a("el-popover",{attrs:{placement:"top-start",trigger:"hover"}},[a("el-table",{attrs:{border:"",data:r.row.test_indicator_list_[e.test_type_name][l.detail][1]}},[a("el-table-column",{attrs:{label:"检测次数",prop:"test_times"}}),a("el-table-column",{attrs:{label:"检测值",prop:"value"}}),a("el-table-column",{attrs:{label:"试验方法名称",prop:"test_method_name"}}),a("el-table-column",{attrs:{label:"等级",prop:"level"}}),a("el-table-column",{attrs:{label:"结果",prop:"mes_result"}})],1),a("el-button",{attrs:{slot:"reference"},slot:"reference"},[t._v(t._s(r.row.test_indicator_list_[e.test_type_name][l.detail][0].value))])],1)]:void 0}}],null,!0)})})),a("el-table-column",{attrs:{label:"等级",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){var l=a.row;return[t._v(" "+t._s(l.test_indicator_list_[e.test_type_name].maxLevel)+" ")]}}],null,!0)}),a("el-table-column",{attrs:{label:"检测结果",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){var l=a.row;return[t._v(" "+t._s(l.test_indicator_list_[e.test_type_name].mes_result)+" ")]}}],null,!0)})],2)})),a("el-table-column",{attrs:{label:"综合等级",prop:"maxLevel"}}),a("el-table-column",{attrs:{label:"综合检测结果",width:"110",prop:"mes_result"}})],2),a("page",{attrs:{total:t.total,"current-page":t.getParams.page},on:{currentChange:t.currentChange}}),a("el-dialog",{attrs:{title:"选择过滤",visible:t.filterDialogVisible},on:{"update:visible":function(e){t.filterDialogVisible=e}}},[a("el-table",{attrs:{border:"",data:t.testTypeList}},[a("el-table-column",{attrs:{label:"选择",width:"50"},scopedSlots:t._u([{key:"default",fn:function(e){var l=e.row;return[a("el-checkbox",{model:{value:l.show,callback:function(e){t.$set(l,"show",e)},expression:"row.show"}})]}}])}),a("el-table-column",{attrs:{label:"实验方法",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){var l=e.row;return[a("span",[t._v(t._s(l.test_type_name))])]}}])}),a("el-table-column",{attrs:{label:"检测项"},scopedSlots:t._u([{key:"default",fn:function(e){var l=e.row;return[t._l(l.data_indicator_detail,(function(e){return[a("el-checkbox",{key:e.detail,model:{value:e.show,callback:function(a){t.$set(e,"show",a)},expression:"item.show"}},[t._v(t._s(e.detail))])]}))]}}])})],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.filterDialogVisible=!1}}},[t._v("关闭")])],1)],1),a("el-dialog",{attrs:{title:"胶料信息卡",width:"80%",visible:t.testCardDialogVisible},on:{"update:visible":function(e){t.testCardDialogVisible=e}}},[a("test-card",{ref:"testCard"})],1)],1)},r=[],s=(a("99af"),a("4de4"),a("4160"),a("d81d"),a("13d5"),a("159b"),a("5530")),n=(a("96cf"),a("1da1")),i=a("5a0c"),o=a.n(i),c=a("3e51"),u=a("34be"),d=a("8448"),_=a("cfc4"),p=a("1c2f"),m=a("1b10"),b=a("89c6"),f={components:{PlanSchedulesSelect:u["a"],EquipSelect:d["a"],ClassSelect:_["a"],ProductNoSelect:p["a"],TestCard:m["a"],Page:c["a"]},data:function(){return{total:0,getParams:{page:1,day_time:o()().format("YYYY-MM-DD"),equip_no:null,classes:null,product_no:null},listLoading:!0,filterDialogVisible:!1,testCardDialogVisible:!1,testTypeList:[{test_type_id:null,test_type_name:"",show:!1,data_indicator_detail:[{detail:"",show:!1}]}],testOrders:[]}},created:function(){this.getTestTypes(),this.getMaterialTestOrders()},methods:{dayTimeChanged:function(){this.getMaterialTestOrdersPage1()},equipSelected:function(t){this.getParams.equip_no=t?t.equip_no:null,this.getMaterialTestOrdersPage1()},classSelected:function(t){this.getParams.classes=t||null,this.getMaterialTestOrdersPage1()},productBatchingChanged:function(t){this.getParams.product_no=t?t.stage_product_batch_no:null,this.getMaterialTestOrdersPage1()},getMaterialTestOrdersPage1:function(){this.getParams.page=1,this.getMaterialTestOrders()},matchedTestData:function(t,e,a){var l=null,r=t.order_results.filter((function(t){return t.test_indicator_name===e.test_type_name})).filter((function(t){return t.data_point_name===a.detail}));r.length>0&&(l=r.reduce((function(t,e){return t.test_times>e.test_times?t:e}),[]),r.sort((function(t,e){e.test_times,t.test_times})));var s=[l,r];return s},currentChange:function(t){this.getParams.page=t,this.getMaterialTestOrders()},getMaterialTestOrders:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.listLoading=!0,e.prev=1,t.testOrders=[],e.next=5,Object(b["b"])(t.getParams);case 5:a=e.sent,t.total=a.count,t.testOrders=a.results.map((function(t){return Object(s["a"])(Object(s["a"])({},t),{},{class_group:"".concat(t.production_class,"/").concat(t.production_group)})})),t.testOrders.forEach((function(e){e.maxLevel=0,e.mes_result="未检测",e.test_indicator_list_={},t.testTypeList.forEach((function(a){e.test_indicator_list_[a.test_type_name]={};var l=0,r="未检测";a.data_indicator_detail.forEach((function(s){var n=t.matchedTestData(e,a,s);e.test_indicator_list_[a.test_type_name][s.detail]=n,n[0]&&n[0].level>l&&(l=n[0].level,r=n[0].mes_result)})),e.test_indicator_list_[a.test_type_name]["maxLevel"]=l,e.test_indicator_list_[a.test_type_name]["mes_result"]=r,l>e.maxLevel&&(e.maxLevel=l,e.mes_result=r)}))})),e.next=13;break;case 11:e.prev=11,e.t0=e["catch"](1);case 13:t.listLoading=!1;case 14:case"end":return e.stop()}}),e,null,[[1,11]])})))()},getTestTypes:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t.testTypeList=[],e.next=4,Object(b["d"])();case 4:a=e.sent,t.testTypeList=a.map((function(t){return t.data_indicator_detail=t.data_indicator_detail.map((function(t){return{detail:t,show:!0}})),Object(s["a"])(Object(s["a"])({},t),{},{show:!0})})),e.next=10;break;case 8:e.prev=8,e.t0=e["catch"](0);case 10:case"end":return e.stop()}}),e,null,[[0,8]])})))()},showCard:function(t){var e=this;this.testCardDialogVisible=!0,this.$nextTick((function(){e.$refs["testCard"].setTestData(t)}))}}},g=f,h=a("2877"),v=Object(h["a"])(g,l,r,!1,null,null,null);e["default"]=v.exports}}]);