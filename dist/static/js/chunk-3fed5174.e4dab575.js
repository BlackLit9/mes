(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3fed5174"],{1642:function(e,t,a){"use strict";var n=a("3d48"),r=a.n(n);r.a},"3d48":function(e,t,a){},"74d9":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"manual_entry_style"},[a("el-form",{attrs:{inline:!0}},[a("el-form-item",{attrs:{label:"工厂日期："}},[a("el-date-picker",{attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd"},on:{change:e.pageOne},model:{value:e.search.factory_date,callback:function(t){e.$set(e.search,"factory_date",t)},expression:"search.factory_date"}})],1),a("el-form-item",{attrs:{label:"生产机台："}},[a("equip-select",{attrs:{equip_no_props:e.search.equip_no},on:{"update:equip_no_props":function(t){return e.$set(e.search,"equip_no",t)},changeSearch:e.pageOne}})],1),a("el-form-item",{attrs:{label:"班次："}},[a("class-select",{on:{classSelected:e.classSelected}})],1),a("el-form-item",{attrs:{label:"胶料："}},[a("all-product-no-select",{on:{productBatchingChanged:e.productBatchingChanged}})],1)],1),e.tableDataStyle.length>0&&e.tableDataChild.length>0?a("el-table",{staticClass:"rigthTable",attrs:{data:[{}],border:"",width:"100%"}},e._l(e.tableDataStyle,(function(t,n){return a("div",{key:n},[a("el-table-column",{attrs:{label:t.test_indicator}},[t.methods.length>0?[e._l(t.methods,(function(n,r){return a("el-radio",{key:r,attrs:{label:n,disabled:!n.allowed},on:{change:function(a){return e.changeMethods(t.test_indicator,t)}},model:{value:t.checkedC,callback:function(a){e.$set(t,"checkedC",a)},expression:"valItem.checkedC"}},[e._v(" "+e._s(n.name)+" ")])})),e._e(),a("br"),a("el-button",{staticStyle:{"margin-top":"5px"},attrs:{size:"mini"},on:{click:function(a){return e.clearRadio(t,n)}}},[e._v("清除")])]:e._e()],2)],1)})),0):e._e(),a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["test_result","add"],expression:"['test_result','add']"}],staticStyle:{float:"right",margin:"10px 0"},attrs:{loading:e.loadingBtn},on:{click:e.submitTable}},[e._v("保 存")]),a("el-table",{ref:"table",attrs:{data:e.tableDataChild,border:""}},[a("el-table-column",{key:"5",attrs:{type:"index",width:"50",label:"No"}}),a("el-table-column",{key:"4",attrs:{label:"生产信息",align:"center"}},[a("el-table-column",{attrs:{prop:"product_no",label:"胶料编码"}}),a("el-table-column",{attrs:{prop:"lot_no",label:"收皮条码"}}),a("el-table-column",{attrs:{prop:"classes",label:"班次"}}),a("el-table-column",{attrs:{prop:"equip_no",label:"生产机台"}}),a("el-table-column",{attrs:{prop:"actual_trains",label:"车次"}})],1),a("div",{key:"1"},e._l(e.changeTable,(function(t,n){return a("div",{key:n},["{}"!==JSON.stringify(t.checkedC)?a("el-table-column",{attrs:{label:t.test_indicator,align:"center"}},[e._l(t.checkedC.data_points,(function(n,r){return a("el-table-column",{key:r,attrs:{label:n.name},scopedSlots:e._u([{key:"default",fn:function(r){return n.name?[a("el-dropdown",{on:{command:function(a){return e.handleCommand(a,r.$index,r.row._list,t.test_indicator,n.name,r.row)}}},[r.row._list[t.test_indicator]&&r.row._list[t.test_indicator][n.name]?a("el-input-number",{attrs:{"controls-position":"right",min:0,step:"比重"===t.test_indicator?.02:1},on:{change:function(t){return e.detectionValue(r.row,r.$index,r.row._list)}},model:{value:r.row._list[t.test_indicator][n.name].value,callback:function(a){e.$set(r.row._list[t.test_indicator][n.name],"value",a)},expression:"scope.row._list[itemTa.test_indicator][itemChild.name].value"}}):e._e(),e.commandList(t.test_indicator).length>0?a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.commandList(t.test_indicator),(function(t,n){return a("el-dropdown-item",{key:n,staticStyle:{width:"150px"},attrs:{command:t}},[e._v(e._s(t))])})),1):e._e()],1)]:void 0}}],null,!0)})})),a("el-table-column",{attrs:{label:"试验方法"},scopedSlots:e._u([{key:"default",fn:function(a){return[e._v(" "+e._s(t.checkedC.name)+" "),e._e()]}}],null,!0)})],2):e._e()],1)})),0),a("el-table-column",{key:"2",attrs:{label:"备注"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{placeholder:"请输入内容"},model:{value:t.row.note,callback:function(a){e.$set(t.row,"note",a)},expression:"scope.row.note"}})]}}])}),a("el-table-column",{key:"3",attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.deleteFunction(t.$index)}}},[e._v("删除")])]}}])})],1),a("view-dialog-trial",{attrs:{show:e.dialogVisible},on:{handleClose:function(t){e.dialogVisible=!1}}})],1)},r=[],l=(a("4de4"),a("c740"),a("4160"),a("a434"),a("b0c0"),a("a9e3"),a("b680"),a("ac1f"),a("841c"),a("159b"),a("ade3")),i=(a("96cf"),a("1da1")),o=a("1f6c"),s=a("ed08"),c=a("4090"),u=a("cfc4"),d=a("5dce"),h=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{attrs:{title:"",visible:e.dialogVisible,width:"80%","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[a("el-form",{attrs:{inline:!0}},[a("el-form-item",{staticStyle:{"margin-right":"50px"},attrs:{label:e.showData.type_name}}),a("el-form-item",{attrs:{label:"胶料编码:"}},[e._v(" "+e._s(e.showData.material_no)+" ")]),e.testMethodSelectShow?a("el-form-item",{attrs:{label:"试验方法:"}},[a("testMethodSelect",{attrs:{"create-load":!0,"test-type-id":e.showData.test_type_id,testmodeprop:e.testMode},on:{changeSelect:e.testMethodChange}})],1):e._e()],1),a("el-table",{attrs:{data:e.tableData,border:"","span-method":e.objectSpanMethod}},[a("el-table-column",{attrs:{prop:"level",label:"等级"}}),a("el-table-column",{attrs:{prop:"result",label:"处理意见"}}),a("el-table-column",{key:0,attrs:{prop:"limits_val",label:"区分"}}),e._l(e.headTable,(function(t,n){return a("el-table-column",{key:n+1,attrs:{label:t.name},scopedSlots:e._u([{key:"default",fn:function(n){return["上限"===n.row.limits_val?a("span",[e._v(" "+e._s(n.row[t.name]?n.row[t.name].upper_limit:"")+" ")]):a("span",[e._v(" "+e._s(n.row[t.name]?n.row[t.name].lower_limit:"")+" ")])]}}],null,!0)})}))],2)],1)])],1)},f=[],b=(a("d3b7"),a("3ca3"),a("ddb0"),a("dbca")),p={components:{testMethodSelect:b["a"]},props:{show:Boolean,showData:{type:Object,default:function(){return{}}}},data:function(){return{dialogVisible:!1,testMode:"",search:this.showData,loading:!0,testMethodSelectShow:!1,tableData:[],headTable:[]}},watch:{show:function(e){this.dialogVisible=e,e&&(this.testMethodSelectShow=!0,this.search=this.showData)}},methods:{getList:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(o["s"])("get",null,{params:e.search});case 3:return a=t.sent,n=[],a.forEach((function(e,t){e.limits_val="上限",n.push(e);var a=Object(s["a"])(e);a.limits_val="下限",n.push(a)})),t.abrupt("return",n);case 9:t.prev=9,t.t0=t["catch"](0),e.loading=!1;case 12:case"end":return t.stop()}}),t,null,[[0,9]])})))()},getTestTypes:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(o["w"])("get",null,{params:e.search});case 3:return a=t.sent,t.abrupt("return",a);case 7:t.prev=7,t.t0=t["catch"](0),e.loading=!1;case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},handleClose:function(e){this.$emit("handleClose",!1),this.testMethodSelectShow=!1,e()},objectSpanMethod:function(e){e.row,e.column;var t=e.rowIndex,a=e.columnIndex;if(0===a||1===a)return t%2===0?{rowspan:2,colspan:1}:{rowspan:0,colspan:0}},testMethodChange:function(e){var t=this;this.search.test_method_id=e,Promise.all([this.getList(),this.getTestTypes()]).then((function(e){t.tableData=e[0],t.headTable=e[1],t.loading=!1})).catch((function(e){t.loading=!1}))}}},m=p,_=a("2877"),g=Object(_["a"])(m,h,f,!1,null,"2678feac",null),v=g.exports,w={components:{equipSelect:c["a"],classSelect:u["a"],allProductNoSelect:d["a"],viewDialogTrial:v},data:function(){return{dialogVisible:!1,loading:!1,total:0,search:{ShiftRules:"",factory_date:Object(s["b"])(),equip_no:"",classes:"",product_no:""},tableData:[],tableDataStyle:[],tableDataChild:[],showTableDataChild:!1,changeTable:[],loadingBtn:!1,arr:[]}},mounted:function(){},methods:{getTableDataChild:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e.titleInfo(e.search.equip_no,"请输入生产机台"),e.titleInfo(e.search.classes,"请输入班次"),e.titleInfo(e.search.product_no,"请输入胶料"),e.titleInfo(e.search.factory_date,"请输入时间"),e.loading=!0,t.next=8,Object(o["A"])("get",null,{params:e.search});case 8:a=t.sent,e.getTestType(e.search.product_no),e.tableDataChild=a||[],e.tableDataChild.forEach((function(t,a){e.$set(t,"_index",a)})),e.loading=!1,t.next=18;break;case 15:t.prev=15,t.t0=t["catch"](0),e.loading=!1;case 18:case"end":return t.stop()}}),t,null,[[0,15]])})))()},titleInfo:function(e,t){if(!e&&0!==e)throw this.$message.info(t),new Error(t)},getList:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.clearData(),e.showTableDataChild=!1,t.prev=2,e.loading=!0,t.next=6,Object(o["z"])("get",null,{params:e.search});case 6:a=t.sent,e.tableData=a.results||[],e.total=a.count,e.loading=!1,t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](2),e.loading=!1;case 15:case"end":return t.stop()}}),t,null,[[2,12]])})))()},getTestType:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Object(o["t"])("get",null,{params:{material_no:e}});case 3:n=a.sent,t.tableDataStyle=n||[],t.tableDataStyle.forEach((function(e){t.$set(e,"checkedC",{})})),a.next=10;break;case 8:a.prev=8,a.t0=a["catch"](0);case 10:case"end":return a.stop()}}),a,null,[[0,8]])})))()},changeMethods:function(e,t){y(this,t)},clearRadio:function(e,t){"{}"!==JSON.stringify(e.checkedC)&&(this.$set(this.tableDataStyle[t],"checkedC",{}),y(this,e))},currentChange:function(e){this.search.page=e,this.getList()},pageOne:function(){this.getTableDataChild(),this.tableDataStyle.forEach((function(e){e.checkedC={}})),this.changeTable=[]},planScheduleSelected:function(e){this.search.ShiftRules=e,this.pageOne()},classSelected:function(e){this.search.classes=e,this.pageOne()},productBatchingChanged:function(e){this.search.product_no=e?e.material_no:"",this.pageOne()},rowClick:function(e){this.getTestType(e.product_no),this.clearData(),this.showTableDataChild=!0;for(var t=(Number(e.end_trains)-Number(e.begin_trains)+1).toFixed(0),a=0;a<t;a++){var n=JSON.parse(JSON.stringify(e));this.$set(n,"input",""),this.$set(n,"actual_trains",Number(e.begin_trains)+a),this.tableDataChild.push(n)}},clearData:function(){this.changeTable=[],this.tableDataStyle=[],this.tableDataChild=[]},deleteFunction:function(e){var t=this;this.$confirm("是否删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.tableDataChild.splice(e,1)}))},viewTrial:function(){this.dialogVisible=!0},handleCommand:function(e,t,a,n,r,l){this.$set(this.tableDataChild[t]._list[n][r],"value",e),this.detectionValue(l,t,a)},commandList:function(e){return"比重"===e?[1.11,1.13,1.15]:"硬度"===e?[59]:[]},detectionValue:function(e,t,a){for(var n in e._filledIn=!1,a)for(var r in a[n])a[n][r].value&&(e._filledIn=!0)},testMethodChange:function(e,t){if(t)for(var a in t)t[a]&&this.$set(t[a],"test_method_name",e)},submitTable:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=[],t.prev=1,0!==e.tableDataChild.length){t.next=4;break}return t.abrupt("return");case 4:n=e.tableDataChild.filter((function(e){return e._filledIn})),n.forEach((function(t,n){var r=[];if(!t.lot_no)throw e.$message.error("收皮条码不能为空！"),new Error("收皮条码不能为空！");if("{}"!==JSON.stringify(t._list))for(var l in t._list)for(var i in t._list[l])t._list[l][i]&&(t._list[l][i].value||(t._list[l][i].value=null),r.push(t._list[l][i]));a[n]={lot_no:t.lot_no,actual_trains:t.actual_trains,product_no:t.product_no,plan_classes_uid:t.plan_classes_uid,production_class:t.classes,production_equip_no:t.equip_no,production_factory_date:t.factory_date,note:t.note,order_results:r}})),t.next=11;break;case 8:return t.prev=8,t.t0=t["catch"](1),t.abrupt("return");case 11:return e.loadingBtn=!0,t.prev=12,t.next=15,Object(o["x"])("post",null,{data:a});case 15:e.$message.success("录入成功"),e.loadingBtn=!1,t.next=22;break;case 19:t.prev=19,t.t1=t["catch"](12),e.loadingBtn=!1;case 22:case"end":return t.stop()}}),t,null,[[1,8],[12,19]])})))()}}};function y(e,t){var a={},n={},r={};if("{}"!==JSON.stringify(t.checkedC)){var i=Object(s["a"])(t.checkedC.data_points);i.forEach((function(n){var l={};e.$set(l,"test_indicator_name",t.test_indicator),e.$set(l,"data_point_name",n.name),e.$set(l,"test_method_name",t.checkedC.name),e.$set(l,"value",void 0),r=Object(s["a"])(l),e.$set(a,n.name,r)})),Object.assign(n,Object(l["a"])({},t.test_indicator,a))}var o=e.changeTable.findIndex((function(e){return e.test_indicator===t.test_indicator}));o>-1?"{}"===JSON.stringify(t.checkedC)?(e.tableDataChild.forEach((function(e){delete e._list[t.test_indicator]})),e.changeTable.splice(o,1)):e.changeTable[o]=t:e.changeTable.push(t),e.tableDataChild.forEach((function(a){if("{}"!==JSON.stringify(t.checkedC)){var r=Object(s["a"])(n);a._list||e.$set(a,"_list",{});var l=Object.assign({},a._list,r);e.$set(a,"_list",l)}else delete a._list[t.test_indicator]}))}var k=w,O=(a("1642"),Object(_["a"])(k,n,r,!1,null,"227e0e87",null));t["default"]=O.exports},c740:function(e,t,a){"use strict";var n=a("23e7"),r=a("b727").findIndex,l=a("44d2"),i=a("ae40"),o="findIndex",s=!0,c=i(o);o in[]&&Array(1)[o]((function(){s=!1})),n({target:"Array",proto:!0,forced:s||!c},{findIndex:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}}),l(o)},daa1:function(e,t,a){"use strict";a.d(t,"d",(function(){return l})),a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return o})),a.d(t,"e",(function(){return s})),a.d(t,"f",(function(){return c})),a.d(t,"g",(function(){return u})),a.d(t,"h",(function(){return d})),a.d(t,"c",(function(){return h}));var n=a("b775"),r=a("99b1");function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a={url:r["a"].MaterialQuantityDemandedUrl,method:e};return Object.assign(a,t),Object(n["a"])(a)}function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a={url:r["a"].ClassArrangelUrl,method:e};return Object.assign(a,t),Object(n["a"])(a)}function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a={url:r["a"].BanburyPlanUrl,method:e};return Object.assign(a,t),Object(n["a"])(a)}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a={url:r["a"].MaterialRepertoryUrl,method:e};return Object.assign(a,t),Object(n["a"])(a)}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a={url:r["a"].MaterialTypelUrl,method:e};return Object.assign(a,t),Object(n["a"])(a)}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a={url:r["a"].RubberRepertoryUrl,method:e};return Object.assign(a,t),Object(n["a"])(a)}function d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a={url:r["a"].StageGlobalUrl,method:e};return Object.assign(a,t),Object(n["a"])(a)}function h(e){return Object(n["a"])({url:r["a"].EquipUrl,method:"get",params:e})}}}]);