(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-748e93b1"],{"1df8":function(e,t,a){"use strict";var l=a("4d91"),n=a.n(l);n.a},"4b5b":function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-form",{attrs:{inline:!0}},[a("el-form-item",{attrs:{label:"日期"}},[a("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"选择日期"},on:{change:e.dayTimeChanged},model:{value:e.getParams.day_time,callback:function(t){e.$set(e.getParams,"day_time",t)},expression:"getParams.day_time"}})],1),a("el-form-item",{attrs:{label:"机台"}},[a("equip-select",{on:{equipSelected:e.equipSelected}})],1),a("el-form-item",{attrs:{label:"班次"}},[a("class-select",{on:{classSelected:e.classSelected}})],1),a("el-form-item",{attrs:{label:"胶料"}},[a("product-no-select",{attrs:{"is-stage-productbatch-no-remove":!0,"make-use-batch":!0},on:{productBatchingChanged:e.productBatchingChanged}})],1),a("el-form-item",{attrs:{label:"段次"}},[a("stage-select",{on:{change:e.stageChange},model:{value:e.getParams.stage,callback:function(t){e.$set(e.getParams,"stage",t)},expression:"getParams.stage"}})],1),a("el-form-item",[a("el-button",{on:{click:function(t){e.filterDialogVisible=!0}}},[e._v(" 显示过滤界面 ")])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"},{name:"el-table-infinite-scroll",rawName:"v-el-table-infinite-scroll",value:e.infiniteScroll,expression:"infiniteScroll"}],staticStyle:{width:"100%","max-height":"500px"},attrs:{data:e.testOrders,border:"",fit:"","row-key":"index",lazy:"",load:e.load,"tree-props":{children:"children",hasChildren:"hasChildren"},"row-class-name":e.tableRowClassName}},[a("el-table-column",{attrs:{label:"生产信息",align:"center"}},[a("el-table-column",{attrs:{label:"生产计划号",width:"220",prop:"plan_classes_uid",align:"center"}}),a("el-table-column",{attrs:{label:"收皮条码",prop:"lot_no"}}),a("el-table-column",{attrs:{label:"生产班次/班组",width:"110",prop:"class_group"}}),a("el-table-column",{attrs:{label:"生产机台",prop:"production_equip_no"}}),a("el-table-column",{attrs:{label:"胶料编码",align:"center",width:"150",prop:"product_no"}}),a("el-table-column",{attrs:{label:"车次",width:"50",align:"center",prop:"actual_trains"}}),a("el-table-column",{attrs:{label:"检测状态",prop:"test_status",align:"center"}})],1),e._l(e.testTypeList.filter((function(e){return e.show})),(function(t){return a("el-table-column",{key:t.test_type_name,attrs:{align:"center",label:t.test_type_name}},[e._l(t.data_indicator_detail.filter((function(e){return e.show})),(function(l){return a("el-table-column",{key:t.test_type_name+l.detail,attrs:{width:"110",label:l.detail,align:"center"}},[a("el-table-column",{attrs:{label:"机台",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){var n=a.row;return[e._v(" "+e._s(e.getDataPoint(t.test_type_name,l.detail,n.order_results,"machine_name"))+" ")]}}],null,!0)}),a("el-table-column",{attrs:{label:"检测值",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){var n=a.row;return[e._v(" "+e._s(e.getDataPoint(t.test_type_name,l.detail,n.order_results,"value"))+" ")]}}],null,!0)}),a("el-table-column",{attrs:{label:"等级",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){var n=a.row;return[e._v(" "+e._s(e.getDataPoint(t.test_type_name,l.detail,n.order_results,"level"))+" ")]}}],null,!0)})],1)})),a("el-table-column",{attrs:{label:"等级",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){var l=a.row;return[e._v(" "+e._s(e.getDataPoint(t.test_type_name,"maxLevelItem",l.order_results,"level"))+" ")]}}],null,!0)})],2)})),a("el-table-column",{attrs:{label:"综合等级",prop:"level",align:"center"}}),a("el-table-column",{attrs:{label:"综合检测结果",width:"110",prop:"mes_result",align:"center"}})],2),a("el-dialog",{attrs:{title:"选择过滤",visible:e.filterDialogVisible},on:{"update:visible":function(t){e.filterDialogVisible=t}}},[a("el-table",{attrs:{border:"",data:e.testTypeList}},[a("el-table-column",{attrs:{label:"选择",width:"50"},scopedSlots:e._u([{key:"default",fn:function(t){var l=t.row;return[a("el-checkbox",{model:{value:l.show,callback:function(t){e.$set(l,"show",t)},expression:"row.show"}})]}}])}),a("el-table-column",{attrs:{label:"实验方法",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){var l=t.row;return[a("span",[e._v(e._s(l.test_type_name))])]}}])}),a("el-table-column",{attrs:{label:"检测项"},scopedSlots:e._u([{key:"default",fn:function(t){var l=t.row;return[e._l(l.data_indicator_detail,(function(t){return[a("el-checkbox",{key:t.detail,model:{value:t.show,callback:function(a){e.$set(t,"show",a)},expression:"item.show"}},[e._v(e._s(t.detail))])]}))]}}])})],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.filterDialogVisible=!1}}},[e._v("关闭")])],1)],1),a("el-dialog",{attrs:{title:"胶料信息卡",width:"80%",visible:e.testCardDialogVisible},on:{"update:visible":function(t){e.testCardDialogVisible=t}}},[a("test-card",{ref:"testCard"})],1)],1)},n=[],r=(a("99af"),a("4160"),a("d81d"),a("a9e3"),a("159b"),a("5530")),s=(a("96cf"),a("1da1")),i=a("5a0c"),o=a.n(i),c=a("34be"),u=a("8448"),d=a("cfc4"),p=a("1c2f"),g=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-select",{attrs:{value:e.id,clearable:"",placeholder:"请选择"},on:{change:function(t){return e.$emit("change",t)},"visible-change":e.visibleChange}},e._l(e.stageOptions,(function(e){return a("el-option",{key:e.id,attrs:{label:e.global_name,value:e.global_name}})})),1)},f=[],m=a("daa1"),h={model:{prop:"id",event:"change"},props:{id:{type:[Number,String],required:!1,default:void 0}},data:function(){return{stageOptions:[]}},created:function(){this.getStageOptions()},methods:{getStageOptions:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(m["h"])("get");case 2:a=t.sent,e.stageOptions=a.results;case 4:case"end":return t.stop()}}),t)})))()},visibleChange:function(e){e&&this.getStageOptions()}}},b=h,_=a("2877"),v=Object(_["a"])(b,g,f,!1,null,null,null),w=v.exports,y=a("89c6"),O=a("c21d"),S={directives:{"el-table-infinite-scroll":O["a"]},components:{PlanSchedulesSelect:c["a"],EquipSelect:u["a"],ClassSelect:d["a"],ProductNoSelect:p["a"],StageSelect:w},data:function(){return{count:0,allPage:0,getParams:{day_time:o()().format("YYYY-MM-DD"),equip_no:null,classes:null,product_no:null,stage:null,page:1},listLoading:!0,filterDialogVisible:!1,testCardDialogVisible:!1,testTypeList:[{test_type_id:null,test_type_name:"",show:!1,data_indicator_detail:[{detail:"",show:!1}]}],testOrders:[],index:1,recordList:[],isMoreLoad:!1,definePafeSize:10}},created:function(){this.getTestTypes(),this.getMaterialTestOrders()},methods:{dayTimeChanged:function(){this.clearList(),this.getMaterialTestOrders()},clearList:function(){this.getParams.page=1,this.allPage=0,this.testOrders=[]},equipSelected:function(e){this.getParams.equip_no=e?e.equip_no:null,this.clearList(),this.getMaterialTestOrders()},stageChange:function(){this.clearList()},classSelected:function(e){this.getParams.classes=e||null,this.clearList(),this.getMaterialTestOrders()},productBatchingChanged:function(e){this.getParams.product_no=e?e.stage_product_batch_no:null,this.clearList(),this.getMaterialTestOrders()},load:function(e,t,a){var l=this,n=[];Object(y["d"])(e.id).then((function(t){for(var r in t){var s=JSON.parse(JSON.stringify(e));s.index=l.index++,s.hasChildren=!1,s.order_results=t[r],n.push(s)}a(n)}))},getMaterialTestOrders:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.listLoading=!0,t.prev=1,t.next=4,Object(y["b"])(e.getParams);case 4:a=t.sent,l=a.results,l=l.map((function(t){return Object(r["a"])(Object(r["a"])({},t),{},{index:e.index++,hasChildren:!0,test_status:"正常",class_group:"".concat(t.production_class,"/").concat(t.production_group)})})),l.forEach((function(e){for(var t in e.level=0,e.mes_result="未检测",e.order_results){var a=e.order_results[t],l=0,n="未检测";for(var r in a){var s=a[r];s.test_times>1&&(e.test_status="复检"),s.level>l&&(l=s.level,n=s.mes_result,a["maxLevelItem"]=s)}l>e.level&&(e.level=l,e.mes_result=n)}})),e.allPage=a.count,e.testOrders=e.testOrders.concat(l),e.listLoading=!1,t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](1),e.listLoading=!1;case 16:case"end":return t.stop()}}),t,null,[[1,13]])})))()},infiniteScroll:function(){Number(this.allPage-this.getParams.page*this.definePafeSize)<0||(this.getParams.page=this.getParams.page+1,this.getMaterialTestOrders())},getTestTypes:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e.testTypeList=[],t.next=4,Object(y["e"])();case 4:a=t.sent,e.testTypeList=a.map((function(e){return e.data_indicator_detail=e.data_indicator_detail.map((function(e){return{detail:e,show:!0}})),Object(r["a"])(Object(r["a"])({},e),{},{show:!0})})),t.next=10;break;case 8:t.prev=8,t.t0=t["catch"](0);case 10:case"end":return t.stop()}}),t,null,[[0,8]])})))()},showCard:function(e){var t=this;this.testCardDialogVisible=!0,this.$nextTick((function(){t.$refs["testCard"].setTestData(e)}))},getDataPoint:function(e,t,a,l){var n=a[e]&&a[e][t]?a[e][t]:null;return n?n[l]:""},tableRowClassName:function(e){var t=e.row;e.rowIndex;return"合格"!==t.mes_result?"warning-row":""}}},k=S,x=(a("1df8"),Object(_["a"])(k,l,n,!1,null,null,null));t["default"]=x.exports},"4d91":function(e,t,a){}}]);